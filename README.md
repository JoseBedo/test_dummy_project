# Dockerizing Django with Postgres, Gunicorn, and Nginx

## Want to learn how to build this?

Check out the [post](https://testdriven.io/dockerizing-django-with-postgres-gunicorn-and-nginx).

## Configure your project

Install Black pip

### Development

Uses the default Django development server.

1. Rename *.env.dev-sample* to *.env.dev*.
1. Update the environment variables in the *docker-compose.yml* and *.env.dev* files.
1. Build the images and run the containers:

    ```sh
    $ docker-compose up -d --build
    ```

    Test it out at [http://localhost:8000](http://localhost:8000). The "app" folder is mounted into the container and your code changes apply automatically.

### Production

Uses gunicorn + nginx.

1. Rename *.env.prod-sample* to *.env.prod* and *.env.prod.db-sample* to *.env.prod.db*. Update the environment variables.
1. Build the images and run the containers:

    ```sh
    $ docker-compose -f docker-compose.prod.yml up -d --build
    ```

    Test it out at [http://localhost:1337](http://localhost:1337). No mounted folders. To apply changes, the image must be re-built.
    
### Runing the pytestmon:
on root directory and outside docker:
docker-compose exec web ./pytest_entrypoint.sh

## Running Jupyter:
Install jupter library on your local docker instance

When creating your container uncomment the notebook library
on root directory and outside docker:
```
$ docker-compose exec api ./jupyter_entrypoint.sh 
```
Enjoy

# Windows 10
## work environment
### Installations

- **[Slack]** :For the installation of slack it was necessary to download the .exe of the program, before it was necessary to register on the platform with the email assigned by the company.
- **[Postman]** : For this installation it was necessary to download the .exe of the most current version of the program, it was also necessary to register with the email provided by the company.
- **[Visual studio code]** : For this installation it is necessary to download the executable in the most current version.
 **Downloaded extensions**
o	Docker v1.22.0
o	Pylace v2022.6.30
o	Python v20222.8.1
- **[Python 3.9]** To download Python it was necessary to download the installer, and run it.
- **[Git]** To install git it was necessary to download the installer, while the installation shows us a list of components to download.
- **[GitHub Desktop]** : graphical git manager to manage the account.
- **[Docker Windows]** : To download Docker it was necessary to download the installer, which installs by default.
o	 Docker version 20.10.14, build a224086
o	Docker-compose version 1.29.2, build 5becea4c


### Windows support

# Python
Since we already have a version of Python 3.6, it is installed and has to be added to the system variables of the new version of Python, I had to change the name of these two files, adding 3.9 so that the new version of Python was detected .
[![N|Solid](https://i.postimg.cc/brDJjJ3y/Version-3-9-python.png)](https://nodesource.com/products/nsolid)

## Git
> Once git was installed, it had to be configured

with these command:
```
git config --global user.name "My Name"
git config --global user.email "myemail@example.com"
```
It was necessary to generate and configure SSH keys in Git

**What is asymmetric cryptography?**
Asymmetric cryptography is the secure way to send and receive a message, because even if it falls into someone else's hands, they will never be able to read the message.

 It is necessary to generate it from Windows with the command:
 ```
 ssh-keygen: which is generated by this view.
 ```
 
 [![N|Solid](https://krisleon99.github.io/portfolio/img/bg/5.png)](https://nodesource.com/products/nsolid)
Then in the folder
``` c:/user/user/.shh/id_rsa ```

We open this document with and paste it into the ssh keys on the git page.
 [![N|Solid](https://krisleon99.github.io/portfolio/img/bg/10.png)](https://nodesource.com/products/nsolid)
 This is how it finally looks.
 [![N|Solid](https://krisleon99.github.io/portfolio/img/bg/9.png)](https://nodesource.com/products/nsolid)

### End of Line: LR CLRF
**What is a line ending character?**
The end of line (EOL) character is actually two ASCII characters: the combination of the CR and LF characters. … The EOL character is used as a newline character in most other non-Unix operating systems, including Microsoft Windows and Symbian OS.

**What is the end of line sequence?**
Description. The term CRLF refers to Carriage Return (ASCII 13, r) Line Feed (ASCII 10, n). ... For example: On Windows both CR and LF are required to annotate the end of a line, while on Linux/UNIX only one LF is required. In the HTTP protocol, the CR-LF sequence is always used to terminate a line.

### create virtual environment
The virtual environment always goes outside the project is independent
```
python3.9 -m venv env
```
command to activate virtual environment in windows
```
source env\Scripts\activate
```

install requirements
```
pip install -r requirements.txt
```
## common tasks

First of all, we clone the repository locally
```
git clone git@github.com:Ave0/holistiqum.git
git pull

git checkout -b ＜new-branch＞
git checkout new-branch
```

### Stripe CLI
Make sure to change the .env variable `STRIPE_FORWARD_URL` and put your local ip address (the one outside your dockers containers). In the rare event that we are not in api/v1 change it as well.

### Commands in Docker
```
Docker-compose up -d
```
This docker-compose command helps build the image, after which it will create and launch the Docker containers. The containers come from the services specified in the configuration file. If the containers are already running and docker-compose up is run, the container will be created again.
``` 
Docker PS -a
```

List all running/quit/stopped Docker containers with container details.

``` 
Docker Logs 
```
The best way to know what is happening in any process is to review its logs. And of course containers are included in the above statement. If things don't work as expected, if your container doesn't finish starting, if it isn't generating the correct output, and you don't know why, the best way to solve it is by looking at its logs.

```
docker-compse up -d 
```

    $ docker-compose -f docker-compose.prod.yml up -d --build


This docker-compose command helps to force the image up.

```
Docker log id
```
The best way to know what is happening in a specific container.
**system variables**
We need to add the variables to the system
```
DEBUG=0
SECRET_KEY=change_me
DJANGO_ALLOWED_HOSTS=localhost [::1]
SQL_ENGINE=django.db.backends.postgresql
SQL_DATABASE=hello_django_prod
SQL_USER=hello_django
SQL_PASSWORD=hello_django
SQL_HOST=db
SQL_PORT=0000
DATABASE=postgres
REDIS_HOST=redis
```
**we execute these commands**
```
Docker-compose up -d
docker ps
```
we can enter the page now
``` http://127.0.0.1:8000/ ```

## Frist PR
**What is a pull request?**
Pull requests are the way to contribute to a group or open source project.

we add changes in the REDME.MD
```
git add ./README.MD
git commit -m "commit message"
git push
```
It would only be necessary for them not to approve it, or to make observations.

## Create a super user
> it has to be inside the container

```
docker exec -it **container id**  /bin/sh 
ls
python manage.py create sueperuser
```

## Default super user in Dev

We automatically create a super user with all permissions in the population script.
username = god@god.com
email = god@god.com
password = fake_password

## save dummy data database to local
```
docker exec -it **container id**  /bin/sh 
python manage.py shell
```
inside python
```
cd utils
python population_dev.py
```



   [Docker Windows]: <https://docs.docker.com/desktop/windows/install/>
   [Git]: <https://git-scm.com/downloads>
   [GitHub Desktop]: <https://desktop.github.com/>
   [Python 3.9]: <https://www.python.org/downloads/>
   [Visual studio code]: <https://code.visualstudio.com/download>
   [Slack]: <https://slack.com/intl/es-mx/downloads/windows>
   [Postman]: <https://www.postman.com/downloads/>
